resource "aws_organizations_account" "infrastructure_account" {
  name  = var.infrastructure_account_name
  email = var.infrastructure_account_email # Must be a unique email address not associated with any other AWS account

  # Specify the Organizational Unit ID of GovernanceOU
  parent_id = aws_organizations_organizational_unit.governance_ou.id 
  
  # Role name created in the new account that the management account can assume
  role_name = var.rolename_for_mgmt_account
  
  # This is a infrastructure account so we do not want to close upon deletion. 
  # We will manually handle account closure if needed.
  # close_on_deletion = true
}

output "infrastructure_account_id" {
  value = aws_organizations_account.infrastructure_account.id
}

resource "aws_organizations_delegated_administrator" "delegated_admin_for_cloudformation" {
   account_id        = aws_organizations_account.infrastructure_account.id
   service_principal = "member.org.stacksets.cloudformation.amazonaws.com"
}
